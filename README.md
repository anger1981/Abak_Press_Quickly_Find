Abak_Press_Quickly_Find
=======================
В памяти есть 10 000 000 объектов со следующими полями:
 
1) возраст (0..100)
2) зарплата (0..1000000,0)
3) рост (0..200)
4) вес (0..200)
 
Нужно написать максимально быстрый алгоритм для выбора объектов по определённым условиям (условий может быть от 0 до 4, в качестве условия можно указать диапазон значений)

Задачу решил введением объекта индекса. Для каждого поля создается объект индекс, содержащий индексы отсортированного по возрастанию массива элементов данного поля. При поиске по диапазону апроксимируем эту зависимость val(ind) прямой от val_min до val_max. Индексы для мин и мах значений ищем отдельными методами по похожим алгоритмам. Для мах сначала находим пересечение с диапазоном, находим реальное значение в месте пересечения, в зависимости от полученного значения(< или > мах) меняем интервалы поиска и ищем новое пересечение и т.д. рекурсивно. С мин аналогично. В результате получаем массив индексов объектов, удовлетворяющих нашему условию по данному полю. Делаем то же самое для других полей. Ищем пересечения полученных массивов - получаем массив индексов элементов, удовлетворяющих условиям поиска по всем полям. Поиск по индексу работает медленно в случае, если значения поля меняются в узком диапазоне - получаются "ступеньки". У меня поиск в пределах ступеньки идет простым перебором, что, естественно, медленно. Можно ввести дополнительные массивы в индекс с границами ступенек и при попадании на ступеньку сразу переходить на нужную границу. Но это увеличит и без того большое время построения индекса. Кроме того из-за отсутствия указателей придется такие массивы формировать в два прохода. Лучше это все реализовать плагином на языке низкого уровня, совместив с операцией сортировки. Кроме того можно поиск вести сначала по полю с широким диапазоном, потом передать его пересечение с обрабатываемым массивом поиску по более узкому диапазону и т.д. На практике все это делают СУБД и лучше пользоваться ими. Пока мой алгоритм проигрывает обычному селекту из раби, поэтому практическая польза от таких упражнений сомнительна.

PS Хотя с широкими диапазонами
1) возраст (0..100_000)
2) зарплата (0..1000_000,0)
3) рост (0..200_000)
4) вес (0..200_000)
мой алгоритм опередил селект в 9 раз.
Если это будет иметь практическую ценность могу реализовать все вышесказанное. Плюс многопоточную сортировку индекса и формирование индекса в отдельном потоке можно прикрутить - еще в разы скорость возрастет.
